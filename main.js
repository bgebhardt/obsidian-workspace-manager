/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => WorkspaceReorgPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// workspace-modal.ts
var import_obsidian = require("obsidian");
var WorkspaceManagerModal = class extends import_obsidian.Modal {
  constructor(app, workspaceManager) {
    super(app);
    this.workspaceManager = workspaceManager;
    this.workspaces = {};
    this.selectedWorkspace = "";
    this.selectedFiles = /* @__PURE__ */ new Set();
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: "Workspace Manager" });
    this.workspaces = await this.workspaceManager.getWorkspaces();
    this.createWorkspaceList(contentEl);
    this.createFileList(contentEl);
    this.createControls(contentEl);
  }
  createWorkspaceList(container) {
    const workspaceContainer = container.createDiv("workspace-list");
    workspaceContainer.createEl("h3", { text: "Workspaces" });
    Object.keys(this.workspaces).forEach((workspaceName) => {
      const workspaceEl = workspaceContainer.createDiv("workspace-item");
      workspaceEl.setText(workspaceName);
      workspaceEl.addClass("clickable-item");
      workspaceEl.addEventListener("click", () => {
        workspaceContainer.querySelectorAll(".selected").forEach(
          (el) => el.removeClass("selected")
        );
        workspaceEl.addClass("selected");
        this.selectedWorkspace = workspaceName;
        this.updateFileList();
      });
    });
  }
  createFileList(container) {
    const fileContainer = container.createDiv("file-list");
    fileContainer.createEl("h3", { text: "Files in Workspace" });
    const fileListEl = fileContainer.createDiv("file-items");
    fileListEl.id = "file-list-content";
  }
  updateFileList() {
    const fileListEl = document.getElementById("file-list-content");
    if (!fileListEl || !this.selectedWorkspace)
      return;
    fileListEl.empty();
    const workspace = this.workspaces[this.selectedWorkspace];
    const tabs = this.workspaceManager.extractTabsFromWorkspace(workspace);
    tabs.forEach((tab) => {
      const fileEl = fileListEl.createDiv("file-item");
      const checkbox = fileEl.createEl("input", { type: "checkbox" });
      checkbox.addEventListener("change", (e) => {
        if (e.target.checked) {
          this.selectedFiles.add(tab.path);
        } else {
          this.selectedFiles.delete(tab.path);
        }
      });
      fileEl.createSpan({ text: tab.title });
      fileEl.createSpan({ text: ` (${tab.path})`, cls: "file-path" });
    });
  }
  createControls(container) {
    const controlsContainer = container.createDiv("controls");
    new import_obsidian.Setting(controlsContainer).setName("Move to workspace").addDropdown((dropdown) => {
      Object.keys(this.workspaces).forEach((name) => {
        dropdown.addOption(name, name);
      });
    });
    const buttonContainer = controlsContainer.createDiv("button-container");
    new import_obsidian.ButtonComponent(buttonContainer).setButtonText("Move Selected Files").onClick(async () => {
      await this.moveSelectedFiles();
    });
    new import_obsidian.ButtonComponent(buttonContainer).setButtonText("Close").onClick(() => {
      this.close();
    });
  }
  async moveSelectedFiles() {
    await this.workspaceManager.saveWorkspaces(this.workspaces);
    this.updateFileList();
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// workspace-manager.ts
var import_obsidian2 = require("obsidian");
var WorkspaceManager = class {
  constructor(app, plugin) {
    this.app = app;
    this.plugin = plugin;
  }
  async getWorkspaces() {
    try {
      const workspaceFile = await this.app.vault.adapter.read(".obsidian/workspaces.json");
      return JSON.parse(workspaceFile);
    } catch (error) {
      new import_obsidian2.Notice("Could not read workspaces file");
      return {};
    }
  }
  async saveWorkspaces(workspaces) {
    try {
      await this.createBackup();
      const jsonString = JSON.stringify(workspaces, null, 2);
      await this.app.vault.adapter.write(".obsidian/workspaces.json", jsonString);
      new import_obsidian2.Notice("Workspaces updated successfully");
    } catch (error) {
      new import_obsidian2.Notice("Failed to save workspaces");
      console.error(error);
    }
  }
  async createBackup() {
    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    const backupName = `.obsidian/workspaces-backup-${timestamp}.json`;
    try {
      const currentWorkspaces = await this.app.vault.adapter.read(".obsidian/workspaces.json");
      await this.app.vault.adapter.write(backupName, currentWorkspaces);
    } catch (error) {
      console.warn("Could not create backup:", error);
    }
  }
  extractTabsFromWorkspace(workspace) {
    const tabs = [];
    const extractFromNode = (node) => {
      var _a;
      if (node.type === "leaf" && ((_a = node.state) == null ? void 0 : _a.file)) {
        tabs.push({
          id: node.id || "",
          path: node.state.file,
          title: node.state.file.split("/").pop() || "",
          type: node.state.type || "markdown"
        });
      } else if (node.children) {
        node.children.forEach(extractFromNode);
      }
    };
    if (workspace.main) {
      extractFromNode(workspace.main);
    }
    return tabs;
  }
  moveFilesBetweenWorkspaces(workspaces, filePaths, fromWorkspace, toWorkspace) {
    return workspaces;
  }
};

// main.ts
var WorkspaceReorgPlugin = class extends import_obsidian3.Plugin {
  async onload() {
    console.log("Loading Workspace Reorganizer");
    this.workspaceManager = new WorkspaceManager(this.app, this);
    this.addRibbonIcon("layout-grid", "Reorganize Workspaces", () => {
      new WorkspaceManagerModal(this.app, this.workspaceManager).open();
    });
    this.addCommand({
      id: "open-workspace-manager",
      name: "Open Workspace Manager",
      callback: () => {
        new WorkspaceManagerModal(this.app, this.workspaceManager).open();
      }
    });
  }
  onunload() {
    console.log("Unloading Workspace Reorganizer");
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJ3b3Jrc3BhY2UtbW9kYWwudHMiLCAid29ya3NwYWNlLW1hbmFnZXIudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IFBsdWdpbiwgTW9kYWwsIE5vdGljZSwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBXb3Jrc3BhY2VNYW5hZ2VyTW9kYWwgfSBmcm9tICcuL3dvcmtzcGFjZS1tb2RhbCc7XG5pbXBvcnQgeyBXb3Jrc3BhY2VNYW5hZ2VyIH0gZnJvbSAnLi93b3Jrc3BhY2UtbWFuYWdlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdvcmtzcGFjZVJlb3JnUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgICB3b3Jrc3BhY2VNYW5hZ2VyOiBXb3Jrc3BhY2VNYW5hZ2VyO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnTG9hZGluZyBXb3Jrc3BhY2UgUmVvcmdhbml6ZXInKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMud29ya3NwYWNlTWFuYWdlciA9IG5ldyBXb3Jrc3BhY2VNYW5hZ2VyKHRoaXMuYXBwLCB0aGlzKTtcblxuICAgICAgICAvLyBBZGQgcmliYm9uIGljb25cbiAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdsYXlvdXQtZ3JpZCcsICdSZW9yZ2FuaXplIFdvcmtzcGFjZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBuZXcgV29ya3NwYWNlTWFuYWdlck1vZGFsKHRoaXMuYXBwLCB0aGlzLndvcmtzcGFjZU1hbmFnZXIpLm9wZW4oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIGNvbW1hbmRcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnb3Blbi13b3Jrc3BhY2UtbWFuYWdlcicsXG4gICAgICAgICAgICBuYW1lOiAnT3BlbiBXb3Jrc3BhY2UgTWFuYWdlcicsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIG5ldyBXb3Jrc3BhY2VNYW5hZ2VyTW9kYWwodGhpcy5hcHAsIHRoaXMud29ya3NwYWNlTWFuYWdlcikub3BlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1VubG9hZGluZyBXb3Jrc3BhY2UgUmVvcmdhbml6ZXInKTtcbiAgICB9XG59IiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFNldHRpbmcsIEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFdvcmtzcGFjZU1hbmFnZXIsIFdvcmtzcGFjZURhdGEsIFRhYkRhdGEgfSBmcm9tICcuL3dvcmtzcGFjZS1tYW5hZ2VyJztcblxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZU1hbmFnZXJNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwcml2YXRlIHdvcmtzcGFjZXM6IFJlY29yZDxzdHJpbmcsIFdvcmtzcGFjZURhdGE+ID0ge307XG4gICAgcHJpdmF0ZSBzZWxlY3RlZFdvcmtzcGFjZTogc3RyaW5nID0gJyc7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZEZpbGVzOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwcml2YXRlIHdvcmtzcGFjZU1hbmFnZXI6IFdvcmtzcGFjZU1hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBhc3luYyBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnV29ya3NwYWNlIE1hbmFnZXInIH0pO1xuXG4gICAgICAgIC8vIExvYWQgd29ya3NwYWNlc1xuICAgICAgICB0aGlzLndvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLndvcmtzcGFjZU1hbmFnZXIuZ2V0V29ya3NwYWNlcygpO1xuXG4gICAgICAgIHRoaXMuY3JlYXRlV29ya3NwYWNlTGlzdChjb250ZW50RWwpO1xuICAgICAgICB0aGlzLmNyZWF0ZUZpbGVMaXN0KGNvbnRlbnRFbCk7XG4gICAgICAgIHRoaXMuY3JlYXRlQ29udHJvbHMoY29udGVudEVsKTtcbiAgICB9XG5cbiAgICBjcmVhdGVXb3Jrc3BhY2VMaXN0KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdignd29ya3NwYWNlLWxpc3QnKTtcbiAgICAgICAgd29ya3NwYWNlQ29udGFpbmVyLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ1dvcmtzcGFjZXMnIH0pO1xuXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMud29ya3NwYWNlcykuZm9yRWFjaCh3b3Jrc3BhY2VOYW1lID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUVsID0gd29ya3NwYWNlQ29udGFpbmVyLmNyZWF0ZURpdignd29ya3NwYWNlLWl0ZW0nKTtcbiAgICAgICAgICAgIHdvcmtzcGFjZUVsLnNldFRleHQod29ya3NwYWNlTmFtZSk7XG4gICAgICAgICAgICB3b3Jrc3BhY2VFbC5hZGRDbGFzcygnY2xpY2thYmxlLWl0ZW0nKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgd29ya3NwYWNlRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHByZXZpb3VzIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0ZWQnKS5mb3JFYWNoKGVsID0+IFxuICAgICAgICAgICAgICAgICAgICBlbC5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgd29ya3NwYWNlRWwuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFdvcmtzcGFjZSA9IHdvcmtzcGFjZU5hbWU7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGaWxlTGlzdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNyZWF0ZUZpbGVMaXN0KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgZmlsZUNvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoJ2ZpbGUtbGlzdCcpO1xuICAgICAgICBmaWxlQ29udGFpbmVyLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0ZpbGVzIGluIFdvcmtzcGFjZScgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBUaGlzIHdpbGwgYmUgcG9wdWxhdGVkIHdoZW4gYSB3b3Jrc3BhY2UgaXMgc2VsZWN0ZWRcbiAgICAgICAgY29uc3QgZmlsZUxpc3RFbCA9IGZpbGVDb250YWluZXIuY3JlYXRlRGl2KCdmaWxlLWl0ZW1zJyk7XG4gICAgICAgIGZpbGVMaXN0RWwuaWQgPSAnZmlsZS1saXN0LWNvbnRlbnQnO1xuICAgIH1cblxuICAgIHVwZGF0ZUZpbGVMaXN0KCkge1xuICAgICAgICBjb25zdCBmaWxlTGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtbGlzdC1jb250ZW50Jyk7XG4gICAgICAgIGlmICghZmlsZUxpc3RFbCB8fCAhdGhpcy5zZWxlY3RlZFdvcmtzcGFjZSkgcmV0dXJuO1xuXG4gICAgICAgIGZpbGVMaXN0RWwuZW1wdHkoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZSA9IHRoaXMud29ya3NwYWNlc1t0aGlzLnNlbGVjdGVkV29ya3NwYWNlXTtcbiAgICAgICAgY29uc3QgdGFicyA9IHRoaXMud29ya3NwYWNlTWFuYWdlci5leHRyYWN0VGFic0Zyb21Xb3Jrc3BhY2Uod29ya3NwYWNlKTtcblxuICAgICAgICB0YWJzLmZvckVhY2godGFiID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVFbCA9IGZpbGVMaXN0RWwuY3JlYXRlRGl2KCdmaWxlLWl0ZW0nKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgY2hlY2tib3ggPSBmaWxlRWwuY3JlYXRlRWwoJ2lucHV0JywgeyB0eXBlOiAnY2hlY2tib3gnIH0pO1xuICAgICAgICAgICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoKGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLmNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzLmFkZCh0YWIucGF0aCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEZpbGVzLmRlbGV0ZSh0YWIucGF0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZpbGVFbC5jcmVhdGVTcGFuKHsgdGV4dDogdGFiLnRpdGxlIH0pO1xuICAgICAgICAgICAgZmlsZUVsLmNyZWF0ZVNwYW4oeyB0ZXh0OiBgICgke3RhYi5wYXRofSlgLCBjbHM6ICdmaWxlLXBhdGgnIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjcmVhdGVDb250cm9scyhjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xzQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdignY29udHJvbHMnKTtcblxuICAgICAgICAvLyBUYXJnZXQgd29ya3NwYWNlIGRyb3Bkb3duXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRyb2xzQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldE5hbWUoJ01vdmUgdG8gd29ya3NwYWNlJylcbiAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93biA9PiB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy53b3Jrc3BhY2VzKS5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24obmFtZSwgbmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBBY3Rpb24gYnV0dG9uc1xuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250cm9sc0NvbnRhaW5lci5jcmVhdGVEaXYoJ2J1dHRvbi1jb250YWluZXInKTtcbiAgICAgICAgXG4gICAgICAgIG5ldyBCdXR0b25Db21wb25lbnQoYnV0dG9uQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ01vdmUgU2VsZWN0ZWQgRmlsZXMnKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubW92ZVNlbGVjdGVkRmlsZXMoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBCdXR0b25Db21wb25lbnQoYnV0dG9uQ29udGFpbmVyKVxuICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ0Nsb3NlJylcbiAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBtb3ZlU2VsZWN0ZWRGaWxlcygpIHtcbiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gZm9yIG1vdmluZyBmaWxlc1xuICAgICAgICAvLyBVcGRhdGUgdGhlIHdvcmtzcGFjZXMgb2JqZWN0IGFuZCBzYXZlXG4gICAgICAgIGF3YWl0IHRoaXMud29ya3NwYWNlTWFuYWdlci5zYXZlV29ya3NwYWNlcyh0aGlzLndvcmtzcGFjZXMpO1xuICAgICAgICB0aGlzLnVwZGF0ZUZpbGVMaXN0KCk7XG4gICAgfVxuXG4gICAgb25DbG9zZSgpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcblxuZXhwb3J0IGludGVyZmFjZSBXb3Jrc3BhY2VEYXRhIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdGFiczogVGFiRGF0YVtdO1xuICAgIGxheW91dDogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRhYkRhdGEge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgdHlwZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgV29ya3NwYWNlTWFuYWdlciB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHA6IEFwcCwgcHJpdmF0ZSBwbHVnaW46IFBsdWdpbikge31cblxuICAgIGFzeW5jIGdldFdvcmtzcGFjZXMoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBXb3Jrc3BhY2VEYXRhPj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRmlsZSA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIucmVhZCgnLm9ic2lkaWFuL3dvcmtzcGFjZXMuanNvbicpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uod29ya3NwYWNlRmlsZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdDb3VsZCBub3QgcmVhZCB3b3Jrc3BhY2VzIGZpbGUnKTtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHNhdmVXb3Jrc3BhY2VzKHdvcmtzcGFjZXM6IFJlY29yZDxzdHJpbmcsIFdvcmtzcGFjZURhdGE+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYmFja3VwIGZpcnN0XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUJhY2t1cCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkod29ya3NwYWNlcywgbnVsbCwgMik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLndyaXRlKCcub2JzaWRpYW4vd29ya3NwYWNlcy5qc29uJywganNvblN0cmluZyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1dvcmtzcGFjZXMgdXBkYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0ZhaWxlZCB0byBzYXZlIHdvcmtzcGFjZXMnKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgY3JlYXRlQmFja3VwKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkucmVwbGFjZSgvWzouXS9nLCAnLScpO1xuICAgICAgICBjb25zdCBiYWNrdXBOYW1lID0gYC5vYnNpZGlhbi93b3Jrc3BhY2VzLWJhY2t1cC0ke3RpbWVzdGFtcH0uanNvbmA7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFdvcmtzcGFjZXMgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLnJlYWQoJy5vYnNpZGlhbi93b3Jrc3BhY2VzLmpzb24nKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIud3JpdGUoYmFja3VwTmFtZSwgY3VycmVudFdvcmtzcGFjZXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgY3JlYXRlIGJhY2t1cDonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHRyYWN0VGFic0Zyb21Xb3Jrc3BhY2Uod29ya3NwYWNlOiBhbnkpOiBUYWJEYXRhW10ge1xuICAgICAgICBjb25zdCB0YWJzOiBUYWJEYXRhW10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlY3Vyc2l2ZWx5IGV4dHJhY3QgdGFicyBmcm9tIE9ic2lkaWFuJ3MgbGF5b3V0IHN0cnVjdHVyZVxuICAgICAgICBjb25zdCBleHRyYWN0RnJvbU5vZGUgPSAobm9kZTogYW55KSA9PiB7XG4gICAgICAgICAgICBpZiAobm9kZS50eXBlID09PSAnbGVhZicgJiYgbm9kZS5zdGF0ZT8uZmlsZSkge1xuICAgICAgICAgICAgICAgIHRhYnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBub2RlLmlkIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBub2RlLnN0YXRlLmZpbGUsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBub2RlLnN0YXRlLmZpbGUuc3BsaXQoJy8nKS5wb3AoKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbm9kZS5zdGF0ZS50eXBlIHx8ICdtYXJrZG93bidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChleHRyYWN0RnJvbU5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh3b3Jrc3BhY2UubWFpbikge1xuICAgICAgICAgICAgZXh0cmFjdEZyb21Ob2RlKHdvcmtzcGFjZS5tYWluKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YWJzO1xuICAgIH1cblxuICAgIG1vdmVGaWxlc0JldHdlZW5Xb3Jrc3BhY2VzKFxuICAgICAgICB3b3Jrc3BhY2VzOiBSZWNvcmQ8c3RyaW5nLCBXb3Jrc3BhY2VEYXRhPixcbiAgICAgICAgZmlsZVBhdGhzOiBzdHJpbmdbXSxcbiAgICAgICAgZnJvbVdvcmtzcGFjZTogc3RyaW5nLFxuICAgICAgICB0b1dvcmtzcGFjZTogc3RyaW5nXG4gICAgKTogUmVjb3JkPHN0cmluZywgV29ya3NwYWNlRGF0YT4ge1xuICAgICAgICAvLyBJbXBsZW1lbnRhdGlvbiBmb3IgbW92aW5nIGZpbGVzIGJldHdlZW4gd29ya3NwYWNlc1xuICAgICAgICAvLyBUaGlzIHJlcXVpcmVzIG1hbmlwdWxhdGluZyB0aGUgbGF5b3V0IHN0cnVjdHVyZVxuICAgICAgICByZXR1cm4gd29ya3NwYWNlcztcbiAgICB9XG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBNkM7OztBQ0E3QyxzQkFBcUQ7QUFHOUMsSUFBTSx3QkFBTixjQUFvQyxzQkFBTTtBQUFBLEVBSzdDLFlBQVksS0FBa0Isa0JBQW9DO0FBQzlELFVBQU0sR0FBRztBQURpQjtBQUo5QixTQUFRLGFBQTRDLENBQUM7QUFDckQsU0FBUSxvQkFBNEI7QUFDcEMsU0FBUSxnQkFBNkIsb0JBQUksSUFBSTtBQUFBLEVBSTdDO0FBQUEsRUFFQSxNQUFNLFNBQVM7QUFDWCxVQUFNLEVBQUUsVUFBVSxJQUFJO0FBQ3RCLGNBQVUsTUFBTTtBQUVoQixjQUFVLFNBQVMsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFHdEQsU0FBSyxhQUFhLE1BQU0sS0FBSyxpQkFBaUIsY0FBYztBQUU1RCxTQUFLLG9CQUFvQixTQUFTO0FBQ2xDLFNBQUssZUFBZSxTQUFTO0FBQzdCLFNBQUssZUFBZSxTQUFTO0FBQUEsRUFDakM7QUFBQSxFQUVBLG9CQUFvQixXQUF3QjtBQUN4QyxVQUFNLHFC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
